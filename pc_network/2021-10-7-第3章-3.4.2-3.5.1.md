### 3.4.2-流水线可靠数据传输协议

rdt3.0是一个停等协议，必须等待已发送分组的ACK到达后才能继续发送，信道利用率非常低

利用率 = (L/R)/(RTT+L/R)    L/R为分组传输时间

解决方法：使用流水线技术，发送多个分组后再等待确认

解决流水线的分组丢失、损坏、乱序、时延过长有两种方法，都是使用重传机制

- 回退N步GBN
- 选择重传SR



### 3.4.3-回退N 步

允许发送方发送多个分组（当有多个分组可用时）而不需等待确认，但已发送未确认的分组不能超过窗口长度N，超过则需要等待确认

基序号：最早未确认分组的序号

下一个序号：最小未使用序号

如果序号字段长度为kbits，则表示范围为[0, 2^k-1]，大于则mod2^k

![network_3_12](C:\Users\Mirai\Desktop\Work\Mark\Sources\images\network_3_12.png)

![network_3_13](C:\Users\Mirai\Desktop\Work\Mark\Sources\images\network_3_13.png)

![network_3_14](C:\Users\Mirai\Desktop\Work\Mark\Sources\images\network_3_14.png)



GBN采用累计确认方式，表明接收方已经正确收到序号n及以前的所有分组

超时事件：发送方仅采用一个定时器，当收到ACK时且仍有未确认分组时重启定时器，当没有时关闭

当接收方收到的不是期待的分组时会丢弃



### 3.4.4-选择重传

GBN的重传机制可能会导致大量分组的重传

选择重传SR只会传输损坏、丢失或超时分组

接收方接收所有分组，失序分组将被缓存至其他分组到达，每个分组都有定时器

![network_3_15](C:\Users\Mirai\Desktop\Work\Mark\Sources\images\network_3_15.png)



![network_3_16](C:\Users\Mirai\Desktop\Work\Mark\Sources\images\network_3_16.png)



**窗口长度N比序号空间小1时，SR协议无法正常工作，N必须小于等于序号空间的一半**



## 3.5-面向连接的运输：TCP



### 3.5.1-TCP连接

TCP面向连接，在正式发送数据之前需相互握手，并建立一条逻辑连接，仅由两个端系统维护，中间的网络元素不参与因为没有运输层



三次握手：客户端发送特殊TCP报文段，服务器用一个特殊TCP报文段响应，客户端再用第三个特殊报文段响应，前两个报文段不承载"有效载荷"-不包括应用层数据，第三个可以



TCP有一个发送缓存，由三次握手建立，会不时取出数据并发送

最大报文段长度MSS：TCP能从缓存中取出数据的最大长度，为了保证封装成链路层帧的长度不超过最大值(最大传输单元，MTU)

MTU=1500，TCP/IP首部长度通常为40字节，则TCP可取出数据长度不超过1460字节

TCP连接的每一端都有发送、接收缓存