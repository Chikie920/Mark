# 第2章-应用层



## 2.1-应用层协议原理

只能基于应用层编写软件



### 2.1.1-网络应用程序体系结构

应用程序体系结构：客户-服务器体系结构(简称C/S模型)、对等体系结构(P2P)

HTTP、SMTP、FTP等使用C/S模式

BitTorrent使用P2P模式



### 2.1.2-进程通信

进行通信的是进程而不是应用程序(进程是操作系统对一个正在运行的程序的一种抽象)



#### 1 . 客户和服务器进程

客户(Client)：发起通信的进程

服务器(Server)：等待联系的进程



#### 2. 进程与计算机网络之问的接口

Socket提供进程与网络的通信接口，准确的说是应用层与运输层的接口

![network_2_1](C:\Users\Mirai\Desktop\Work\Mark\Sources\images\network_2_1.png)



#### 3. 进程寻址

发送数据需要知道对方的地址

地址：

- 主机地址-IP
- 进程标识符-端口号(Port)



### 2.1.3-可供应用程序使用的运输服务

运输层理论上可提供：可靠数据传输、吞吐量、定时、安全性服务

**可靠数据传输：**数据无差错传输

**吞吐量：**确保一定的传输速率

**带宽敏感应用：**对吞吐量要求，需要达到一定的传输速率的应用(如视频应用)

**弹性应用：**根据当时可用的带宽或多或少地利用可供使用的吞吐量，对吞吐量无太大要求

**定时：**以较低时延交付数据

**安全性：**由运输层加密、解密数据



### 2.1.4-因特网提供的运输服务

运输层提供两个运输协议：TCP、UDP



**TCP：面向连接、可靠数据服务、拥塞控制**

**面向连接：**在开始传输之前经过三次握手，为传输数据做准备

**全双工：**当连接建立完成后，双方都可在TCP连接上进行通信

**可靠数据传输服务：**无差错、按序交付

**拥塞控制：**网络拥塞时限制发送速率

**安全套接字-SSL：**TCP安全加强版



**UDP：无连接、不可靠数据传输服务、无拥塞控制**



**实际上目前运输层协议并不提供吞吐量与定时服务，当前的因特网仍能提供满意的服务**



### 2.1.5-应用层协议

应用层协议定义了：

- 交换的**报文类型**，例如请求报文和响应报文
- 各种报文类型的**语法**，如报文中的各个字段及这些字段是如何描述的
- 字段的**语义**，即这些字段中的信息的含义
- 确定一个进程何时以及如何发送报文，对报文进行响应的**规则**



可设置专用的应用层协议



## 2.2-Web和HTTP

**超文本传输协议-HTTP**是web应用层协议

HTTP使用TCP作为运输层协议

HTTP是**无状态协议**：不储存任何客户的状态信息



### 2.2.2-非持续连接和持续连接

**非持续连接**：在响应请求后关闭连接

**持续连接**：通过同一个TCP连接发送请求或响应

HTTP默认使用持续连接



**往返时间-RTT**

一个分组从客户端发送到服务器然后返回客户端所花的时间

![network_2_2](C:\Users\Mirai\Desktop\Work\Mark\Sources\images\network_2_2.png)



**三次握手：**即客户向服务器发送一个小TCP 报文段，服务器用一个小TCP 报文段做出确认和响应，最后，客户向服务器返回确认

客户端在第三次握手的同时发送请求报文



非持续连接的缺点：

- 重新建立连接增加服务器的负担
- 重新建立连接增加RTT



### 2.2.3-HTTP 报文格式



#### HTTP请求报文

包含**请求行**+**首部行**

```html
GET /somedir/page.html HTTP/1.1
Host: www.someschool.edu
Connection: close
User-agent: Mozilla/5.0
Accept-language: fr
```

**请求行：**HTTP报文第一行，由**方法字段**、**URL字段**、**HTTP版本字段**组成

**首部行**：后继的行

每行以一个回车\r和一个换行\n结束，首部行结束时需要两个回车与换行



**方法字段：**包括`GET` 、`POST` 、`HEAD` 、`PUT` 和`DELETE`

- GET-服务器将会返回请求的对象
- POST-常用于上传表单，使用时会将用户输入的表单放在实体体内
- HEAD-与GET类似，服务器会用HTTP报文进行响应，但不包含请求的对象，常用于调试
- PUT-允许用户上传对象到指定的Web 服务器上指定的路径（目录）
- DELETE-允许用户或者应用程序删除Web 服务器上的对象



**URL字段：**要请求的对象的位置



`Host`对象所在主机，通常被代理服务器使用

`Connection: close`表示让服务器不使用持续连接

`User- agent`-浏览器类型

`Accept- language`-语言，不存在该语言则使用默认语言

![network_2_3](C:\Users\Mirai\Desktop\Work\Mark\Sources\images\network_2_3.png)



#### HTTP响应报文

```html
HTTP/1.1 200 OK
Connection: close
Date: Tue, 18 Aug 2015 15:44:04 GMT
Server: Apache/2.2.3 (CentOS)
Last-Modified: Tue, 18 Aug 2015 15:11:03 GMT
Content-Length: 6821
Content-Type: text/html
( data data data data data ... )
```

包含**状态行**、**首部行**、**实体体**

**状态行：**由**协议版本字段**、**状态码**和**相应状态信息**组成



状态码与相应状态信息

- 200 OK: 请求成功，信息在返回的响应报文中
- 301 Moved Permanently: 请求的对象已经被永久转移了，新的URL 定义在响应报文的Location: 首部行中。客户软件将自动获取新的URL
- 400 Bad Request : 一个通用差错代码，指示该请求不能被服务器理解
- 404 Not Found: 被请求的文档不在服务器上
- 505 HTTP Version Not Supported : 服务器不支持请求报文使用的HTTP 协议版本



`Date`服务器产生并发送该响应报文的日期和时间

`Server`服务器类型

`Last-Modified`对象创建或者最后修改的日期和时间

`Content-Length`被发送对象中的首部行字节数。

`Content-Type`指示内容类型



![network_2_4](C:\Users\Mirai\Desktop\Work\Mark\Sources\images\network_2_4.png)



### 2.2.4-用户与服务器的交互：cookie

cookie用于标识一个用户

cookie 技术有4 个组件： 

- 在HTTP 响应报文中的一个cookie 首部行
- 在HTTP 请求报文中的一个cookie 首部行
- 在用户端系统中保留有一个cookie 文件，并由用户的浏览器进行管理
- 位于Web 站点的一个后端数据库。



![network_2_5](C:\Users\Mirai\Desktop\Work\Mark\Sources\images\network_2_5.png)



### 2.2.5-Web缓存

**Web缓存器-代理服务器**：储存最近被请求的对象，减少请求的响应时间，减少接入链路到因特网的通信量



**内容分发网络-CDN**



### 2.2.6-条件GET方法

使用`GET`方法并在请求报文的首部行加入`If-Modified-Since： date` date为具体的时间

服务器仅当自指定日期之后该对象被修改过，才发送该对象

