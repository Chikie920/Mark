### 3.5.2-TCP报文段结构

由首部字段(一般为20bytes)+数据字段构成

![network_3_17](C:\Users\Mirai\Desktop\Work\Mark\Sources\images\network_3_17.png)

**首部介绍**

- 源、目的端口号被用于多路复用与分解(32bits)
- 序号字段对发送的报文段编号(32bits)
- 确认号字段为期待从另一端收到的相应序号的报文段(32bits)
- 接收窗口字段用于流量控制(16bits)
- 首部长度字段指示首部的长度(32bits)
- 选项字段为接收方协商最大报文段的长度(MSS)



#### 序号和确认号

**序号**

TCP根据传送的数据的字节流编号，而不是报文段

TCP隐式的对数据流中的每一个字节编号，分段后将每段第一个字节编号作为序号

![network_3_18](C:\Users\Mirai\Desktop\Work\Mark\Sources\images\network_3_18.png)

**确认号**

主机A填充进报文段的确认号是主机A期望从主机B收到的下一字节编号

TCP只确认该流中至第一个丢失字节为止的字节，所以被称为提供累计确认，一对TCP连接的双方均可随机的选择初始序号





### 3.5.3-往返时间的估计与超时



#### 1. 估计往返时问

使用样本RTT获得往返时间，TCP仅到某时刻做一次测量，只将第一次传输的报文段测量

TCP维持一个SampleRTT均值EstimateRTT

`EstimateRTT = (1-a)*EstimateRTT_Old+a*SampleRTT`    (a推荐值为0.125)



RTT偏差DevRTT估算SampleRTT偏离EstimateRTT的程度

`EstimateRTT = （1-b*DevRTT_Old+b*|SampleRTT-EstimateRTT|`   (b推荐值为0.25)



超时间隔`Timeoutlnterval = EstimateRTT +4*DevRTT`



每次获取新的SampleRTT，EstimateRTT、DevRTT与Timeoutlnterval都更新



### 3.5.4-可靠数据传输

看书比较好
