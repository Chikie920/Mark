## 7.2 - 使用正则表达式查找文本模式



### 7.2.1 - 创建正则表达式对象

python的正则表达式函数在 `re` 模块中

`import re` 导入模块

`re.compile()` 传入一个字符串值，返回一个 `Regex` 对象

`\d`匹配一个数字

创建一个Regex来匹配电话号码 

```python
import re
phone = re.compile(r'\d\d\d-\d\d\d-\d\d\d\d')
#phone为一个Regex对象
```



### 7.2.2 - 匹配Regex对象

Regex对象的的search方法查找字符串，寻找所有匹配，没有找到则返回`None`，找到了返回一个`Match`对象，`Match`对象有一个`group()`方法，返回匹配的文本

```python
import re

phone = re.compile(r'\d\d\d-\d\d\d-\d\d\d\d')
result = phone.search('My phone number is 158-279-9693.')
print(result.group())

'''
158-279-9693
'''
```



## 7.3 - 用正则表达式匹配更多模式



### 7.3.1 - 利用括号分组

如果想将电话号码的区域号分离，使用括号进行分组

```python
import re

phone = re.compile(r'(\d\d\d)-(\d\d\d-\d\d\d\d)')
result = phone.search('My phone number is 158-279-9693.')
print(result.group(0))
print(result.groups())
print(result.group(1))
print(result.group(2))

'''
158-279-9693
('158', '279-9693')
158
279-9693
'''
```



### 7.3.2 - 用管道匹配多个分组

`|` 称为管道，希望匹配多个字符串中的一个时使用，例如 `Batman|Tina Fey`将匹配 `Batman` 或 `Tina Fey`

当两个都存在时，返回先出现的匹配值

```python
import re

target = re.compile(r'Batman|Tina Fey')
result = target.search('Batman and Tina Fey')
print(result.group())

'''
Batman
'''
```



**如果要匹配的内容前缀都相同可以用括号**

```python
import re

target = re.compile(r'Bat(man|mobile|copter|bat)')
result = target.search('Batmobile')
print(result.group())
print(result.group(1))

'''
Batmobile
'mobile'
'''
```



### 7.3.3 - 用问号实现可选匹配

问号之前的分组为可选分组，不论该文本是否存在都会匹配

```python
import re

target = re.compile(r'Bat(mo)?bile')
result = target.search('Batmobile')
print(result.group())

'''
Batmobile
'''

'''
(mo)?表明为可选分组
'''
```



### 7.3.4 - 用星号匹配零次或多次

星号之前的分组可以出现零次或多次

```python
import re

target = re.compile(r'Bat(mo)*bile')
result = target.search('Batmomomobile')
result_two = target.search('Batbile')
print(result.group())
print(result_two.group())

'''
Batmomomobile
Batbile
'''
```



### 7.3.5 - 用加号匹配一次或多次

```python
import re

target = re.compile(r'Bat(mo)+bile')
result = target.search('Batmomomobile')
print(result.group())

'''
Batmomomobile
'''
```

**正则表达式匹配不成功会报错**



### 7.3.6 - 用花括号匹配特定次数

`(HA){3}` 将匹配字符串 `HAHAHA` 等效于 `HAHAHA`或 `(HA)(HA)(HA)`

`(HA){2, 3}` 等效于 `(HA)(HA)|(HA)(HA)(HA)`

`(HA){, 5}` 将匹配0~5各实例



## 7.4 - 贪心和非贪心匹配

- Python的正则表达式默认是**贪心**的，当匹配 `HAHAHAHAHA`字符串时，若给定的正则表达式为 `(HA){3, 5}`，最终结果将是 `HAHAHAHAHA` ， 它会尽可能的匹配更长的字符串

- 在花括号后加 `?` 得到**非贪心**版本

例 `re.compile(r'(HA){3, 5}?')`



## 7.5 - findall()方法

除了 `research()` 方法，`Regex`对象还有 `findall()`方法，如果正则表达式未分组，它将返回一组匹配成功的字符串**列表**；如果已分组，则返回一组匹配成功的字符串的**元组的列表**

```python
import re

target = re.compile(r'\d\d\d-\d\d\d-\d\d\d\d')
result = target.findall('My phones number are 158-276-2333 and 157-233-1567.')
print(result)

'''
['158-276-2333', '157-233-1567']
'''
```



```python
import re

target = re.compile(r'(\d\d\d)-(\d\d\d-\d\d\d\d)')
result = target.findall('My phones number are 158-276-2333 and 157-233-1567.')
print(result)

'''
[('158', '276-2333'), ('157', '233-1567')]
'''
```



## 7.6 - 字符分类

- `\d` 匹配0~9任意数字
- `\D` 匹配除0~9的数字以外任意字符
- `\w` 匹配任何字母、数字或下划线字符(可认为是匹配单词字符)
- `\W`  匹配除字母、数字或下划线字符以外的其他字符
- `\s` 匹配空格、制表符或换行符(匹配空字符)
- `\S` 匹配除空格、制表符或换行符以外的其他字符



**字符分类对缩短正则表达式很有用**

字符分类 `[0-5]` 只匹配 数字0-5，比 `(0|1|2|3|4|5)` 简短很多

 `[a-zA-Z]` 匹配字母

 `[a-zA-Z0-9]` 匹配字母、数字

**`[]`内所有字符都是匹配对象**



## 7.7 - 建立自己的字符分类

```python
import re

target = re.compile(r'[abcAFG]')
result = target.findall('ABCabaabcAGfF')
print(result)

'''
['A', 'a', 'b', 'a', 'a', 'b', 'c', 'A', 'G', 'F']
'''
```



**在字符分类括号内左上角加上 `^`号表示匹配该字符分类以外的的字符**

```python
import re

target = re.compile(r'[^abcAFG]')
result = target.findall('ABCabaabcAGfF')
print(result)

'''
['B', 'C', 'f']
'''
```



## 7.8 - 插入字符和美元字符

- 在正则表达式开头加上 `^` 表明匹配必须发生在目标字符串的开始处
- 在正则表达式末尾加上 `$` 表明匹配必须发生在目标字符串的结尾处

```python
import re

target = re.compile(r'^Hello')
result = target.findall('Hello, Wrold')
print(result)

'''
['Hello']
'''

import re

target = re.compile(r'Wrold$')
result = target.findall('Hello, Wrold')
print(result)

'''
['Wrold']
'''
```



## 7.9 - 通配字符

`.` 为通配字符，将匹配处换行符以外的其他所有字符

```python
import re

target = re.compile(r'.at')
result = target.findall('The cat in the hat is sat on the flat mat')
print(result)

'''
['cat', 'hat', 'sat', 'lat', 'mat']
'''
```



### 7.9.1 - 用点-星匹配所有字符

`(.*)`

```python
import re

target = re.compile(r'First name is (.*) Last name is (.*)')
result = target.search('My First name is xxx Last name is www')
print(result.group())
print(result.group(1))
print(result.group(2))

'''
First name is xxx Last name is www
xxx
www
'''
```



### 7.9.2 - 用句点字符匹配换行符

```python
import re

target = re.compile(r'.*', re.DOTALL)
result = target.search('Hello\nWorld\n\n!')
print(result.group())

'''
Hello
World

!
'''
```



## 7.11 - 不区分大小写的匹配

向 `re.compile()` 第二个参数传入 `re.I`或`re.IGNORECASE`使匹配不区分大小写



## 7.12 - 用sub()方法替换字符

正则表达式不仅能够找到字符而且可以替换这些字符

`Regex`对象的 `sub()`方法需要两个参数，参一为用于替换匹配的字符串，参二为目标串

```python
import re

target = re.compile(r'div')
result = target.sub('html', '<div> hello world </div>')
print(result)


'''
<html> hello world </html>
'''
```



有时候我们需要使用匹配文本的本身作为替换的一部分，可在`sub()`方法的第一个参数前加上 `\1、\2、\3`替换掉分组1、2、3的文本



```python
import re

target = re.compile(r'Agent (\w)\w*')
result = target.sub(r'\1***', 'Agent Alice told Agent Carol')
print(result)


'''
A*** told C***
'''
```



## 7.13 - 管理复杂的正则表达式

使用 `''' '''`将正则表达式放在多行中，有必要用 `#`号写注释，让正则表达式易于可读



## 7.14 - 组合使用re.IGNORECASE、re.DOTALL和re.VERBOSE

可以使用管道字符组合参数

`re.compile('fool', re.IGNORECASE | re.DOTALL | re.VERBOSE)`

